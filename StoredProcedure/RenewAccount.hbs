CREATE PROCEDURE spRenewAccount 
	-- Add the parameters for the stored procedure here
	@pAccountGuid nvarchar(40),
	@RenewalId nvarchar(50),
	@RenewalBy nvarchar(50)
AS
BEGIN
	BEGIN TRANSACTION
		BEGIN TRY
		{{#each Items}}
			--Insert record into {{Name}}Pending from {{Name}}
			INSERT INTO [EDAAccountManagement].[dbo].[{{Name}}Pending](
			{{#each Columns}}
			{{#xIfNotAny IsAutoKey "===" true}}
				[{{Name}}]{{#xNotLast}},{{/xNotLast}}{{#xLast}}){{/xLast}}
			{{/xIfNotAny}}
			{{/each}}
			SELECT 
			{{#each Columns}}
			{{#xIfNotAny IsAutoKey "===" true}}
				[{{Name}}]{{#xNotLast}},{{/xNotLast}}
			{{/xIfNotAny}}
			{{/each}}
			FROM [EDAAccountManagement].[dbo].[{{Name}}]
			WHERE GUID_FIELD_GOES_HERE = @pAccountGuid;
.
			--Delete record from {{Name}}
			DELETE FROM [EDAAccountManagement].[dbo].[{{Name}}]
			WHERE GUID_FIELD_GOES_HERE = @pAccountGuid;
.
		{{/each}}
.
			UPDATE [EDAAccountManagement].[dbo].[tblAMAccountSpecificSetup]
			SET [fldRenewedBy] = @RenewalBy,
				[fldRenewedByID] = @RenewalId,
				[fldRenewedDate] = GETDATE()
			WHERE fldGUID = @pAccountGuid;
.
			UPDATE [EDAAccountManagement].[dbo].[tblAMPracticeSpecificSetup]
			SET [fldRenewedBy] = @RenewalBy,
				[fldRenewedByID] = @RenewalId,
				[fldRenewedDate] = GETDATE()
			WHERE fldAccountGUID = @pAccountGuid;
.
		END TRY
		BEGIN CATCH
			--Throw custom error
			ROLLBACK TRANSACTION
		END CATCH
	ROLLBACK TRANSACTION
	END
GO
.